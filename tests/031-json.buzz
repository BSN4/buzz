import "std";
import "json";

test "Json.encode" {
    Boxed json = Boxed {
        map = {
            "hello": Boxed { string = "world" },
            "bye": Boxed { integer = 42 },
        },
    };

    assert(
        encode(json) == `\{"hello":"world","bye":42}`,
        message: "valid encode"
    );
}

test "Json.decode" {
    assert(
        decode(`[ -12, true, "hello" ]`).listValue()[2].string == "hello",
        message: "could decode simple JSON"
    );
}

test "Boxed.q" {
    Boxed json = Boxed {
        map = {
            "submap": Boxed{
                map = {
                    "subsubmap": Boxed{
                        map = {
                            "one": Boxed{ integer = 1 },
                            "two": Boxed{ integer = 2 },
                        }
                    }
                }
            }
        },
    };

    assert(json.q(["submap", "subsubmap", "one"]).integer == 1, message: "Boxed.q");
}